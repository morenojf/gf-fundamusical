<button class="registrar-operacion-button" (click)="genTrigger()">
  <span class="plus-icon">+</span> REGISTRAR OPERACIÓN
</button>

<ng-template #template>
  <div class="main-content">
    <div class="modal-header">
      <button class="close-modal-x" closeModal>x</button>
    </div>

    <h3 class="modal-title">Registro de operación</h3>

    <!-- Inicio formulario aperturar un periodo -->
    <!-- PADRE -->
    <form
      class="periodo-form"
      (submit)="submitForm()"
      [formGroup]="formRegistroOperacion"
    >
      <!-- HIJO 1 -->
      <!-- Fecha y Hora | Periodo | Tipo de Transacción -->
      <div class="first-row">
        <!-- Fecha -->
        <mat-form-field>
          <mat-label>Fecha</mat-label>
          <input
            matInput
            [matDatepicker]="datepicker"
            matInput
            [min]="minDate"
            [max]="maxDate"
            formControlName="fecha"
			readonly
          />
          <mat-datepicker #datepicker />
          <mat-datepicker-toggle [for]="datepicker" matIconSuffix>
            <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
          </mat-datepicker-toggle>
        </mat-form-field>

        <!-- Hora -->
        <mat-form-field>
          <mat-label>Hora</mat-label>
          <input matInput [matTimepicker]="timepicker" formControlName="hora" />
          <mat-timepicker #timepicker />
          <mat-timepicker-toggle [for]="timepicker" matSuffix />
        </mat-form-field>

        <!-- Periodo -->
        <mat-form-field>
          <mat-label>Periodo</mat-label>
          <mat-select
            formControlName="selectedPeriodo"
            (selectionChange)="getPeriodoPartidas($event.value)"
          >
            @for (periodo of periodosArray; track $index) {
            <mat-option [value]="periodo.periodoId"
              >{{periodo.periodoAnio}}</mat-option
            >
            }
          </mat-select>
        </mat-form-field>

        <!-- Tipo -->
        <mat-form-field>
          <mat-label>Tipo de Transacción</mat-label>
          <mat-select [(value)]="operacionTipo" formControlName="ingresoEgreso">
            <mat-option value="INGRESO">INGRESO</mat-option>
            <mat-option value="EGRESO">EGRESO</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- HIJO 2 -->
      <!-- Partidas disponibles | Descripción -->
      <div class="second-row">
        <!-- Partidas disponibles -->
        @if (operacionTipo === "EGRESO") {
        <mat-form-field class="partidas-periodo">
          <mat-label>Partidas disponibles</mat-label>
          <mat-select formControlName="partida">
            @for (partida of partidas; track $index) {
            <mat-option
              [value]="partida.partidaId"
              [disabled]="!periodoIsSelected"
              >{{partida.partidaName}}</mat-option
            >
            }
          </mat-select>
        </mat-form-field>
        }

        <!-- Descripción de transacción -->
        <mat-form-field class="descripcion-operacion">
          <mat-label>Descripción</mat-label>
          <textarea
            matInput
            placeholder="Descripción de Operación"
            formControlName="descripcion"
          ></textarea>
        </mat-form-field>
      </div>

      <!-- HIJO 3 -->
      <!-- Referencia | Monto  -->
      <div class="third-row">
        <!-- Numero de comprobante/referencia -->
        <mat-form-field class="n-comprobante">
          <mat-label>N° Comprobante/Referencia</mat-label>
          <input matInput formControlName="nComprobante" />
        </mat-form-field>

        <!-- Monto Total de la Operación -->
        <mat-form-field floatLabel="always" class="monto">
          <mat-label>Monto</mat-label>
          <input
            matInput
            type="number"
            placeholder="0,00"
            min="1"
            step="1"
            formControlName="montoOperacion"
          />
          <span matTextPrefix>Bs.S</span>
        </mat-form-field>
      </div>

      <!-- HIJO 4 -->
      <!-- Parrafo dinamico instrucción adjuntar archivo -->
      <div class="fourth-row">
        @if (operacionTipo === "INGRESO") {
        <p>
          Para <b>"registrar"</b> la operación debe adjuntar el comprobante de
          transacción en formato PDF o JPG.
        </p>
        } @else {
        <p>
          Para <b>"registrar"</b> la operación debe adjuntar el comprobante de
          transacción y la carta de "Solicitud a Sociedad de Amigos del Sistema" en formato PDF o JPG.
        </p>
        }
      </div>

      <!-- HIJO 5 -->
      <!-- Botones dinamicos de adjuntar archivos -->
      <div class="fifth-row">
        <!-- Adjuntar factura -->
        <div class="invoice-attachment">
          <button matButton type="button" (click)="facturaInput.click()">
            <input
              type="file"
              #facturaInput
              style="display: none"
              (change)="onFacturaSelected($event)"
              name="facturaRuta"
            />
            Adjuntar Comprobante <b style="color: red">*</b>
            <span class="soporte-icon">&#8593;</span>
          </button>
          <!-- Comprobación contenido factura -->
          @if (facturaName !== '') {
          <div class="soporte-file-info">
            <span class="soporte-file-none">{{facturaName}}</span>
          </div>
          } @else {
          <div class="soporte-file-info">
            <span class="soporte-file-none">Sin archivos adjuntos</span>
          </div>
          }
        </div>

        <!-- Adjuntar carta solicitud a Sociedad Amigos del Sistema de fondos -->
        @if (operacionTipo === "EGRESO") {
        <div class="letter-attachment">
          <button matButton type="button" (click)="cartaInput.click()">
            <input
              type="file"
              #cartaInput
              style="display: none"
              (change)="onCartaSelected($event)"
              name="soporteCartaRuta"
            />
            Adjuntar Carta de Solicitud a Sociedad de Amigos del Sistema <b style="color: red">*</b
            ><span class="soporte-icon">&#8593;</span>
          </button>
          <!-- Contenido de adjunto (si existe) -->
          @if (cartaName !== '') {
          <div class="soporte-file-info">
            <span class="soporte-file-none">{{cartaName}}</span>
          </div>
          } @else {
          <div class="soporte-file-info">
            <span class="soporte-file-none">Sin archivos adjuntos</span>
          </div>
          }
        </div>
        }
      </div>

      <button class="btn-crear">REGISTRAR</button>
    </form>
  </div>
</ng-template>
<!-- <mat-form-field></mat-form-field> -->
