<ng-template #template>
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Crear nuevo Núcleo</h3>
      <button class="close-modal-x" closeModal>x</button>
    </div>

    <!-- Inicio formulario aperturar un periodo -->
    <!-- PADRE -->
    <form class="nucleo-form" [formGroup]="formCreateNucleo">
      <!-- HIJO 1 -->
      <!-- Fecha y Hora | Periodo | Tipo de Transacción -->
      <div class="first-row">
        <!-- Fecha -->
        <mat-form-field>
          <mat-label>Nombre del Núcleo</mat-label>
          <input matInput formControlName="nucleoName" />
        </mat-form-field>
      </div>
      <button matButton="filled" type="button" (click)="submitForm()">
        Registrar
        <mat-icon>add</mat-icon>
      </button>
    </form>
  </div>
</ng-template>

<div class="main-content">
  <table class="user-table">
    <thead>
      <tr>
        <th>Nucleo ID</th>
        <th>Nombre</th>
        <th style="text-align: end;">Editar Nombres</th>
      </tr>
    </thead>
    <tbody>
      @if (!nucleosArray?.length) {
      <td>No existen Núcleos creados</td>

      } @else { @for (nucleo of nucleosArray; track $index) {
      <tr>
        <!--Nucleo ID-->
        <td>
          <p>{{nucleo.nucleoId}}</p>
        </td>
        <!--Nombre del Nucleo -->
        <td>
          @if (editingNucleoId === nucleo.nucleoId) {
          <span class="input-measure" #measureSpan
            >{{editData.nucleoName || nucleo.nucleoName}}</span
          >
          <input
            type="text"
            [(ngModel)]="editData.nucleoName"
            [placeholder]="nucleo.nucleoName"
            [style.width.px]="measureSpan.offsetWidth"
            (input)="onInputResize(measureSpan, editData.nucleoName || nucleo.nucleoName)"
          />
          } @else {
          <p>{{nucleo.nucleoName}}</p>
          }
        </td>
        <td style="text-align: end;">
          <!-- editar button -->
          @if (editingNucleoId === nucleo.nucleoId) {
          <!-- Botón check verde -->
          <button
            class="action-btn confirm"
            title="Confirmar"
            (click)="confirmEdit(nucleo)"
          >
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
              <path
                d="M5 13l4 4L19 7"
                stroke="#28a745"
                stroke-width="2"
                fill="none"
              />
            </svg>
          </button>
          } @else {
          <!-- Botón lápiz -->
          <button
            class="action-btn edit"
            title="Editar"
            (click)="startEdit(nucleo)"
          >
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
              <path
                d="M3 17.25V21h3.75l11.06-11.06-3.75-3.75L3 17.25z"
                stroke="#0073aa"
                stroke-width="2"
              />
              <path
                d="M14.06 4.94l3.75 3.75"
                stroke="#0073aa"
                stroke-width="2"
              />
            </svg>
          </button>
          }
        </td>
      </tr>
      } }
    </tbody>
  </table>
</div>

<button id="create-btn" matButton="filled" type="button" (click)="genTrigger()">
  CREAR NÚCLEO
  <mat-icon>add</mat-icon>
</button>
